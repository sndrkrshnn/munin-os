#!/usr/bin/env bash
set -euo pipefail

BIN_CANDIDATES=(
  "/opt/muninos/bin/munin-sts"
  "/usr/local/bin/muninos-sts"
)

CORE_ENDPOINT="${CORE_ENDPOINT:-http://127.0.0.1:8787}"
BRAIN_ENDPOINT="${BRAIN_ENDPOINT:-http://127.0.0.1:8790}"

for bin in "${BIN_CANDIDATES[@]}"; do
  if [[ -x "$bin" ]]; then
    exec "$bin" start --core-endpoint "$CORE_ENDPOINT" --brain-endpoint "$BRAIN_ENDPOINT"
  fi
done

echo "[munin-sts] no sts binary found. looked in: ${BIN_CANDIDATES[*]}" >&2
exit 1
